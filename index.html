<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Trust Bank | Secure Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load sql.js for real SQL execution -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        :root {
            --bank-blue: #0a2540;
            --bank-gold: #c39d63;
        }

        body {
            background-color: #f6f9fc;
            font-family: 'Inter', sans-serif;
            color: var(--bank-blue);
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .login-card, .dashboard-card, .store-card {
            background: white;
            box-shadow: 0 50px 100px -20px rgba(50, 50, 93, 0.25), 0 30px 60px -30px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            border-top: 4px solid var(--bank-gold);
        }

        .input-field {
            border: 1px solid #e6ebf1;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: var(--bank-gold);
            outline: none;
            box-shadow: 0 0 0 2px rgba(195, 157, 99, 0.2);
        }

        .hidden-view {
            display: none !important;
        }

        .stat-card {
            border-left: 4px solid var(--bank-gold);
            background: #fdfdfd;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--bank-blue);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .nav-link {
            @apply px-4 py-2 rounded transition-colors text-sm font-medium cursor-pointer;
        }
        .nav-link.active {
            @apply bg-white/10 text-white;
        }
        .nav-link:not(.active) {
            @apply text-gray-400 hover:text-white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Bank Header -->
    <header class="w-full bg-[#0a2540] text-white p-4 flex justify-between items-center shadow-lg sticky top-0 z-40">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-[#c39d63] rounded-full flex items-center justify-center">
                    <span class="font-bold text-[#0a2540]">GT</span>
                </div>
                <span class="font-semibold tracking-tight text-lg">GLOBAL TRUST BANK</span>
            </div>
            
            <!-- Navigation Tabs (Only visible when logged in) -->
            <nav id="main-nav" class="hidden flex gap-2">
                <div onclick="showView('dashboard')" id="nav-dashboard" class="nav-link active">DASHBOARD</div>
                <div onclick="showView('store')" id="nav-store" class="nav-link">PREMIUM STORE</div>
            </nav>
        </div>

        <div id="user-display" class="hidden text-sm flex items-center gap-6">
            <div class="text-right">
                <span class="text-gray-400 block text-[10px] font-bold uppercase">Available Funds</span>
                <span id="header-balance" class="text-[#c39d63] font-mono font-bold">$0.00</span>
            </div>
            <div class="h-8 w-px bg-white/10"></div>
            <span class="text-gray-400">User: <strong id="logged-in-user" class="text-white">---</strong></span>
            <button onclick="logout()" class="text-xs bg-white/10 hover:bg-white/20 px-3 py-1 rounded transition-colors">LOGOUT</button>
        </div>
        <div id="version-display" class="text-xs uppercase tracking-widest text-gray-400 font-bold">
            Portal v8.4.2
        </div>
    </header>

    <main class="flex-1 flex items-center justify-center p-6">
        
        <!-- View 1: Login UI -->
        <div id="login-view" class="login-card w-full max-w-md p-8">
            <div class="mb-8 text-center">
                <h2 class="text-2xl font-bold text-gray-800">Secure Sign In</h2>
                <p class="text-sm text-gray-500 mt-1">Authorized Personnel Only</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Account ID</label>
                    <input type="text" id="username" class="input-field w-full p-3 rounded" placeholder="Enter Account ID">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Access PIN</label>
                    <input type="password" id="password" class="input-field w-full p-3 rounded" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button id="login-btn" class="w-full bg-[#0a2540] text-white font-bold py-3 rounded hover:bg-[#1a3a5a] transition-all mt-2 active:scale-95 disabled:opacity-50">
                    <span id="btn-text">AUTHORIZE ACCESS</span>
                </button>
            </div>

            <div class="mt-6 pt-6 border-t border-gray-100 flex justify-between text-xs text-gray-400">
                <a href="#" class="hover:underline">Encrypted Recovery</a>
                <a href="#" class="hover:underline">Security Protocols</a>
            </div>
            <div id="error-msg" class="mt-4 text-center text-red-500 text-sm hidden">
                Invalid credentials or system timeout.
            </div>
        </div>

        <!-- View 2: Post-Login Dashboard -->
        <div id="dashboard-view" class="dashboard-card w-full max-w-4xl p-8 hidden-view">
            <div class="flex justify-between items-end mb-8 border-b pb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">Operational Dashboard</h2>
                    <p class="text-gray-500">Global Asset Management & Vault Controls</p>
                </div>
                <div class="text-right">
                    <span class="text-xs font-bold text-gray-400 block">LAST LOGIN</span>
                    <span id="current-time" class="text-sm font-mono text-gray-700"></span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="stat-card p-4 rounded shadow-sm">
                    <span class="text-xs text-gray-400 font-bold uppercase">Liquid Assets</span>
                    <p id="stat-liquid-assets" class="text-2xl font-bold text-gray-800">$0.00</p>
                </div>
                <div class="stat-card p-4 rounded shadow-sm">
                    <span class="text-xs text-gray-400 font-bold uppercase">Active Vaults</span>
                    <p class="text-2xl font-bold text-gray-800">28</p>
                </div>
                <div class="stat-card p-4 rounded shadow-sm">
                    <span class="text-xs text-gray-400 font-bold uppercase">System Status</span>
                    <p class="text-2xl font-bold text-green-500">OPERATIONAL</p>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    Internal Audit: Restricted Database View
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-50 text-gray-400 font-bold uppercase text-[10px]">
                            <tr>
                                <th class="p-3">UID</th>
                                <th class="p-3">Label</th>
                                <th class="p-3">Reference</th>
                                <th class="p-3">Access Hash</th>
                            </tr>
                        </thead>
                        <tbody id="vault-table-body" class="divide-y divide-gray-100">
                            <!-- Injected via SQL Result -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- View 3: Premium Store -->
        <div id="store-view" class="store-card w-full max-w-5xl p-8 hidden-view">
            <div class="mb-8 border-b pb-6">
                <h2 class="text-3xl font-bold text-gray-800">Exclusive Luxury Marketplace</h2>
                <p class="text-gray-500">Acquire elite assets using authorized account liquidities.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="store-items">
                <!-- Items injected via JS -->
            </div>
        </div>
    </main>

    <footer class="p-6 text-center text-gray-400 text-[10px] uppercase tracking-widest">
        &copy; 2026 Global Trust Financial Group. All Rights Reserved.
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-10 right-10 transform translate-y-20 opacity-0 bg-gray-900 text-white px-6 py-3 rounded shadow-2xl transition-all duration-300 flex items-center gap-3 z-50">
        <div id="toast-icon" class="w-2 h-2 rounded-full bg-green-500"></div>
        <span id="toast-msg">Purchase Successful</span>
    </div>

    <script>
        let db;
        let currentUser = null;
        let userBalances = {}; // Format: { "username": amount }
        
        const views = {
            login: document.getElementById('login-view'),
            dashboard: document.getElementById('dashboard-view'),
            store: document.getElementById('store-view')
        };
        
        const storeItems = [
            { id: 1, name: "Private Island (Maldives)", price: 15000000, img: "ðŸï¸" },
            { id: 2, name: "Gulfstream G700 Jet", price: 75000000, img: "âœˆï¸" },
            { id: 3, name: "Superyacht 'The Kraken'", price: 250000000, img: "ðŸ›¥ï¸" },
            { id: 4, name: "Penthouse (Manhattan)", price: 45000000, img: "ðŸ™ï¸" },
            { id: 5, name: "10,000 BTC Voucher", price: 650000000, img: "ðŸª™" },
            { id: 6, name: "Luxury Watch Collection", price: 2500000, img: "âŒš" }
        ];

        /**
         * Persist balances to money.json
         */
        async function saveBalance() {
            try {
                await fetch('money.json', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userBalances)
                });
            } catch (err) {
                console.warn("Storage unreachable, maintaining state in-memory.");
            }
        }

        /**
         * Load balances from money.json and ensure all users exist
         */
        async function loadBalances() {
            try {
                const response = await fetch('money.json');
                if (response.ok) {
                    const data = await response.json();
                    userBalances = data || {};
                }
            } catch (err) {
                console.log("No existing money.json found. Creating internal registry.");
            }

            // Expanded User list with real names
            const users = [
                'Arthur_Vance', 
                'Elena_Rodriguez', 
                'Marcus_Thorne', 
                'Sophia_Chen', 
                'David_Ames', 
                'Isabella_Rossi',
                'SYSTEM_ADMIN'
            ];
            
            users.forEach(user => {
                if (!(user in userBalances)) {
                    userBalances[user] = 42901440.00; // Default starting balance
                }
            });
            
            await saveBalance(); // Update JSON with the full user list
            updateUIBalance();
        }

        function showView(viewName) {
            Object.keys(views).forEach(key => {
                views[key].classList.add('hidden-view');
            });
            views[viewName].classList.remove('hidden-view');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${viewName}`);
            if (activeNav) activeNav.classList.add('active');
        }

        function updateUIBalance() {
            if (!currentUser) return;
            const balance = userBalances[currentUser] || 0;
            const formatted = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(balance);
            document.getElementById('header-balance').innerText = formatted;
            document.getElementById('stat-liquid-assets').innerText = formatted;
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            document.getElementById('toast-icon').className = `w-2 h-2 rounded-full ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        function buyItem(id) {
            const item = storeItems.find(i => i.id === id);
            if (userBalances[currentUser] >= item.price) {
                userBalances[currentUser] -= item.price;
                updateUIBalance();
                saveBalance();
                showToast(`Acquired: ${item.name}`);
            } else {
                showToast("Insufficient Liquidity in Hacked Account", true);
            }
        }

        function renderStore() {
            const container = document.getElementById('store-items');
            container.innerHTML = storeItems.map(item => `
                <div class="border border-gray-100 rounded-lg p-6 hover:shadow-md transition-shadow flex flex-col items-center text-center">
                    <div class="text-5xl mb-4">${item.img}</div>
                    <h4 class="font-bold text-lg text-gray-800 mb-1">${item.name}</h4>
                    <p class="text-[#c39d63] font-mono font-bold mb-6">${new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(item.price)}</p>
                    <button onclick="buyItem(${item.id})" class="mt-auto w-full py-2 bg-[#0a2540] text-white text-xs font-bold rounded hover:bg-black transition-colors">INITIATE PURCHASE</button>
                </div>
            `).join('');
        }

        async function initDatabase() {
            const SQL = await initSqlJs({
                locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}`
            });
            db = new SQL.Database();
            db.run("CREATE TABLE users (id INT, username TEXT, pin TEXT, role TEXT);");
            db.run("CREATE TABLE vault_records (id TEXT, client TEXT, balance TEXT, secret TEXT);");
            
            // Expanded Personnel Roster
            db.run("INSERT INTO users VALUES (1, 'Arthur_Vance', 'Vance_92', 'CHIEF_OPERATIONS');");
            db.run("INSERT INTO users VALUES (2, 'Elena_Rodriguez', 'ER_2026!', 'SENIOR_AUDITOR');");
            db.run("INSERT INTO users VALUES (3, 'Marcus_Thorne', 'Thorne_X', 'SECURITY_LEAD');");
            db.run("INSERT INTO users VALUES (4, 'Sophia_Chen', 'Chen_88*', 'PORTFOLIO_MGR');");
            db.run("INSERT INTO users VALUES (5, 'David_Ames', 'Ames_P@ss', 'SYSTEMS_ADMIN');");
            db.run("INSERT INTO users VALUES (6, 'Isabella_Rossi', 'Rossi_99', 'COMPLIANCE');");
            
            // Expanded Client Vault Records
            db.run("INSERT INTO vault_records VALUES ('TXN_4492', 'Michael Sterling', '$1,204,500', 'FLAG{REAL_SQL_BYPASS_SUCCESS}');");
            db.run("INSERT INTO vault_records VALUES ('TXN_8810', 'Vanessa Kross', '$12,000,000', 'VAULT_KEY_001');");
            db.run("INSERT INTO vault_records VALUES ('TXN_1102', 'Julian Thorne', '$5,400,000', 'VAULT_KEY_002');");
            db.run("INSERT INTO vault_records VALUES ('TXN_9921', 'Clarissa Vacker', '$850,220', 'VAULT_KEY_003');");
            db.run("INSERT INTO vault_records VALUES ('TXN_2003', 'Liam O''Connor', '$3,150,000', 'VAULT_KEY_004');");
            db.run("INSERT INTO vault_records VALUES ('TXN_5055', 'Sarah Jenkins', '$22,400,000', 'VAULT_KEY_005');");
            db.run("INSERT INTO vault_records VALUES ('TXN_7128', 'Hiroshi Tanaka', '$7,800,000', 'VAULT_KEY_006');");
            db.run("INSERT INTO vault_records VALUES ('TXN_3341', 'Amara Okafor', '$15,200,500', 'VAULT_KEY_007');");
            
            renderStore();
            await loadBalances();
        }

        function logout() {
            currentUser = null;
            showView('login');
            document.getElementById('main-nav').classList.add('hidden');
            document.getElementById('user-display').classList.add('hidden');
            document.getElementById('version-display').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function populateDashboard(results) {
            const tableBody = document.getElementById('vault-table-body');
            tableBody.innerHTML = '';
            if (!results || results.length === 0) return;
            const values = results[0].values;
            values.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors";
                tr.innerHTML = row.map(val => `<td class="p-3 font-mono text-gray-700">${val}</td>`).join('');
                tableBody.appendChild(tr);
            });
        }

        document.getElementById('login-btn').onclick = async () => {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const errorMsg = document.getElementById('error-msg');
            const btnText = document.getElementById('btn-text');
            const loginBtn = document.getElementById('login-btn');

            errorMsg.classList.add('hidden');
            btnText.innerHTML = '<span class="loader"></span> VERIFYING...';
            loginBtn.disabled = true;

            setTimeout(() => {
                try {
                    const query = `SELECT * FROM users WHERE username='${u}' AND pin='${p}'`;
                    const res = db.exec(query);

                    if (res.length > 0 && res[0].values.length > 0) {
                        const userData = res[0].values[0];
                        currentUser = userData[1]; // Set current user session
                        
                        // Handle cases where a SQL injection user isn't in our registry yet
                        if (!(currentUser in userBalances)) {
                            userBalances[currentUser] = 42901440.00;
                            saveBalance();
                        }

                        document.getElementById('logged-in-user').innerText = currentUser.replace('_', ' ');
                        
                        const dashboardData = db.exec("SELECT * FROM vault_records LIMIT 4");
                        populateDashboard(dashboardData);

                        document.getElementById('main-nav').classList.remove('hidden');
                        document.getElementById('user-display').classList.remove('hidden');
                        document.getElementById('version-display').classList.add('hidden');
                        document.getElementById('current-time').innerText = new Date().toLocaleString();
                        updateUIBalance();
                        showView('dashboard');
                    } else {
                        errorMsg.classList.remove('hidden');
                    }
                } catch (e) {
                    errorMsg.innerText = "Security Intercept: " + e.message;
                    errorMsg.classList.remove('hidden');
                } finally {
                    btnText.innerText = 'AUTHORIZE ACCESS';
                    loginBtn.disabled = false;
                }
            }, 600);
        };

        initDatabase();
    </script>
</body>
</html>
